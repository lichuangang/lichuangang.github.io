<!DOCTYPE html>
<!--
BeyondAdmin - Responsive Admin Dashboard Template build with Twitter Bootstrap 3.2.0
Version: 1.0.0
Purchase: http://wrapbootstrap.com
-->

<html xmlns="http://www.w3.org/1999/xhtml">
<!-- Head -->
<head>
    <meta charset="utf-8" />
    <title>值班查询</title>

    <meta name="description" content="calendar" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="shortcut icon" href="assets/img/favicon.png" type="image/x-icon">

    <!--Basic Styles-->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" />
    <link id="bootstrap-rtl-link" href="" rel="stylesheet" />
    <link href="assets/css/font-awesome.min.css" rel="stylesheet" />
    <link href="assets/css/weather-icons.min.css" rel="stylesheet" />
    <!--Beyond styles-->
    <link id="beyond-link" href="assets/css/beyond.min.css" rel="stylesheet" />
    <link href="assets/css/demo.min.css" rel="stylesheet" />
    <link href="assets/css/typicons.min.css" rel="stylesheet" />
    <link href="assets/css/animate.min.css" rel="stylesheet" />

    <!--Skin Script: Place this script in head to load scripts for skins and rtl support-->
    <script src="assets/js/skins.min.js"></script>
    <link href="assets/css/bootstrap-datepicker.css" rel="stylesheet" />

    <style>
        tbody tr td {
            font-size: 20px;
        }
    </style>
</head>
<!-- /Head -->
<!-- Body -->
<body>
    <!-- Loading Container -->
    <div class="loading-container">
        <div class="loading-progress">
            <div class="rotator">
                <div class="rotator">
                    <div class="rotator colored">
                        <div class="rotator">
                            <div class="rotator colored">
                                <div class="rotator colored"></div>
                                <div class="rotator"></div>
                            </div>
                            <div class="rotator colored"></div>
                        </div>
                        <div class="rotator"></div>
                    </div>
                    <div class="rotator"></div>
                </div>
                <div class="rotator"></div>
            </div>
            <div class="rotator"></div>
        </div>
    </div>
    <!--  /Loading Container -->
    <!-- Main Container -->
    <div class="main-container container-fluid">
        <!-- Page Container -->
        <div class="page-container">
            <!-- Page Body -->
            <div class="page-body">
                <div class="row" id="grid">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <div class="widget flat">
                            <div class="widget-header bordered-bottom bordered-sky">
                                <i class="widget-icon fa fa-calendar sky"></i>
                                <span class="widget-caption">值班查询</span>
                            </div><!--Widget Header-->
                            <div class="widget-body">
                                <div class="widget-main no-padding">
                                    <div id='grid'>
                                        <div class="table-toolbar">
                                            <div class="dataTables_filter">
                                                <label style="float:left;margin-right:10px">
                                                    <input id="night-date" type="search" class="form-control date-picker" data-date-format="yyyy-mm-dd" style="line-height:35px" v-model="PageInfo.Keyword" placeholder="请设置一个夜班时间">
                                                </label>

                                                <div style="float:left;margin-right:10px">
                                                    <select id="year">
                                                        <option>2016</option>
                                                        <option>2017</option>
                                                        <option>2018</option>
                                                    </select>
                                                </div>

                                                <div style="float:left;margin-right:10px">
                                                    <select id="month">
                                                        <option>01</option>
                                                        <option>02</option>
                                                        <option>03</option>
                                                        <option>04</option>
                                                        <option>05</option>
                                                        <option>06</option>
                                                        <option>07</option>
                                                        <option>08</option>
                                                        <option>09</option>
                                                        <option>10</option>
                                                        <option>11</option>
                                                        <option>12</option>
                                                    </select>
                                                </div>

                                                <label style="margin-left:10px;">
                                                    <button type="button" class="btn btn-default" onclick="SearchBy()">
                                                        查询
                                                    </button>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="table-scrollable">
                                            <table class="table table-striped table-bordered table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>
                                                            星期天
                                                        </th>
                                                        <th>
                                                            星期一
                                                        </th>
                                                        <th>
                                                            星期二
                                                        </th>
                                                        <th>
                                                            星期三
                                                        </th>
                                                        <th>
                                                            星期四
                                                        </th>
                                                        <th>
                                                            星期五
                                                        </th>
                                                        <th>
                                                            星期六
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr v-for="item in DateItem">
                                                        <td>{{item[0]}} </td>
                                                        <td>{{item[1]}} </td>
                                                        <td>{{item[2]}} </td>
                                                        <td>{{item[3]}} </td>
                                                        <td>{{item[4]}} </td>
                                                        <td>{{item[5]}} </td>
                                                        <td>{{item[6]}} </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div><!--Widget Main Container-->
                            </div><!--Widget Body-->
                        </div>
                    </div>
                </div>
            </div>
            <!-- /Page Body -->
        </div>
        <!-- /Page Container -->
        <!-- Main Container -->
    </div>

    <!--Basic Scripts-->
    <script src="assets/js/jquery-2.0.3.min.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>

    <script src="assets/js/vue/vue.min.js"></script>
    <!--Beyond Scripts-->
    <script src="assets/js/beyond.min.js"></script>

    <script src="assets/js/datetime/bootstrap-datepicker.js"></script>
    <script src="assets/js/jquery.cookie.js"></script>
    <script>
        /*
        白班9  休息  白班8  休息   夜班 休息
        2      2     2      2      2    2
        $.cookie('the_cookie', 'the_value', { expires: 7 }); //7天有效

        $.cookie('the_cookie'); // cookie存在 => 'the_value' //获取
        */
        var baseArr = ['夜班', '夜班', '休息', '休息', '白班A', '白班A', '休息', '休息', '白班B', '白班B', '休息', '休息'];
        var cookieKey = "ck-night-date";
        var vue;

        $(function () {
            vue = new Vue({
                el: "#grid",
                data: {
                    DateItem: []
                }
            });


            //--Bootstrap Date Picker--
            $('.date-picker').datepicker({
                autoclose: true,
                clearBtn: true,
            });
            var date = $.cookie(cookieKey);
            if (date) {
                //$("#night-date").val(date);
                setDefaultDate(date);
                SearchBy()

            }
        });

        function setDefaultDate(queryDate) {
            var arrs = queryDate.split('|');
            realDate = getDate(arrs[0]);
            $('.date-picker').datepicker('setDate', realDate);

            $("#year").val(arrs[1]);
            $("#month").val(arrs[2]);

        }

        function getDate(dateStr) {
            dateParts = dateStr.match(/(\d+)/g)
            return new Date(dateParts[0], dateParts[1] - 1, dateParts[2]);
        }

        function SearchBy() {
            var nightDate = $("#night-date").val();
            var year = $("#year").val();
            var month = $("#month").val();
            $.cookie(cookieKey, nightDate + '|' + year + '|' + month, { expires: 365 });
            var index = getIndex(nightDate);
            vue.DateItem = getArr(index);
        }

        function getIndex(nightDate) {
            var diffDays = getDayDiffer(getDate(nightDate), getFirstDate());
            if (diffDays > 0) {
                //说明是往前推
                diffDays = diffDays % 12;
                return diffDays == 0 ? 0 : 12 - diffDays;
            } else {
                //往后推
                diffDays = diffDays * (-1);
                diffDays = diffDays % 12;
                return diffDays;
            }
        }

        function getDayDiffer(day1, day2) {//计算相差天数
            var number_of_days = (day1 - day2) / 86400000;
            return number_of_days;
        }


        function getArr(index) {
            var dateArr = [];
            var thisDate = {};
            var firstDate = getFirstDate();
            var j = firstDate.getDay();
            //这个月天数
            for (var i = 1; i <= maxMonthDay() ; i++) {
                thisDate[j] = i + ':' + baseArr[index];
                index = (index + 1) % 12;

                if (j == 6) {//一周结束
                    j = 0;
                    dateArr.push(thisDate);
                    thisDate = {};
                } else {
                    j++;
                }
            }
            if (j != 0) {
                dateArr.push(thisDate);
            }
            return dateArr;
        }

        //获得当前月最大天数
        function maxMonthDay() {
            var year = $("#year").val();
            var month = $("#month").val();
            return new Date(year, month, 0).getDate();
        }

        function getFirstDate() {
            var year = $("#year").val();
            var month = $("#month").val();
            var firstDate = new Date(year, month - 1, 1);
            return firstDate;
        }

    </script>

</body>
<!--  /Body -->
</html>
